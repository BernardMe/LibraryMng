CREATE DATABASE  IF NOT EXISTS `db_library` DEFAULT CHARACTER SET utf8 ;USE `db_library`;-- ---------------------------------------------------------------- 创建业务数据表-- --------------------------------------------------------------CREATE TABLE `tb_bookinfo` (`bookid` int(11) UNSIGNED ZEROFILL NOT NULL AUTO_INCREMENT COMMENT '图书id',`bookname` varchar(70) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '图书名称',`typeid` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '图书类型id<FK>',`author` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '图书作者',`translator` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '翻译者',`isbn` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT 'ISBN编号<FK>',`price` float(8,2) NULL DEFAULT NULL COMMENT '图书价格',`page` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '总页数',`shelfid` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '所属书架id',`intime` date NULL DEFAULT NULL COMMENT '上架时间',`operator` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '操作员',`del` tinyint(1) NULL DEFAULT 0 COMMENT '是否删除',PRIMARY KEY (`bookid`) ,INDEX `fk_shelfid` (`shelfid` ASC) USING BTREE,INDEX `fk_typeid` (`typeid` ASC) USING BTREE,INDEX `fk_isbn` (`isbn` ASC) USING BTREE)ENGINE = InnoDBAUTO_INCREMENT = 7DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciROW_FORMAT = Compact;CREATE TABLE `tb_booktype` (`typeid` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '图书类型id',`typename` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '图书类型名称',`days` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '可借天数',PRIMARY KEY (`typeid`) ,UNIQUE INDEX `uk_typename` (`typename` ASC) USING BTREE COMMENT '类型唯一' )ENGINE = InnoDBAUTO_INCREMENT = 5DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '图书类型表'ROW_FORMAT = Compact;CREATE TABLE `tb_borrow` (`swid` int(10) UNSIGNED ZEROFILL NOT NULL AUTO_INCREMENT COMMENT '流水号',`rid` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '读者id<FK>',`bookid` int(11) UNSIGNED NULL DEFAULT NULL COMMENT '图书id',`borrowtime` date NULL DEFAULT NULL COMMENT '借出时间',`limitbacktime` date NULL DEFAULT NULL COMMENT '限制归还时间',`ifback` tinyint(1) NULL DEFAULT 0 COMMENT '是否归还',`operator` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '操作员',PRIMARY KEY (`swid`) ,INDEX `fk_borrow_rid` (`rid` ASC) USING BTREE,INDEX `fk_borrow_bookid` (`bookid` ASC) USING BTREE)ENGINE = InnoDBAUTO_INCREMENT = 11DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '图书借出表'ROW_FORMAT = Compact;CREATE TABLE `tb_library` (`libraryid` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '图书馆id',`libraryname` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '图书馆名称',`curator` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '馆长姓名',`tel` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '联系电话',`address` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '联系地址',`email` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT 'Email',`url` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '图书馆网址',`createdate` date NULL DEFAULT NULL COMMENT '建馆时间',`introduce` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '图书馆简介',PRIMARY KEY (`libraryid`) )ENGINE = InnoDBAUTO_INCREMENT = 2DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '图书馆信息表'ROW_FORMAT = Compact;CREATE TABLE `tb_manager` (`mid` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '管理员id',`mname` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '管理员用户名',`mpwd` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '管理员密码',PRIMARY KEY (`mid`) ,INDEX `uk_mname` (`mname` ASC) USING BTREE)ENGINE = InnoDBAUTO_INCREMENT = 5DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '管理员表'ROW_FORMAT = Compact;CREATE TABLE `tb_parameter` (`paraid` int(10) UNSIGNED NOT NULL AUTO_INCREMENT,`cost` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '办卡费用',`validity` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '有效期限',PRIMARY KEY (`paraid`) )ENGINE = InnoDBAUTO_INCREMENT = 2DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '办卡参数表'ROW_FORMAT = Compact;CREATE TABLE `tb_publishing` (`isbn` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '' COMMENT 'isbn编码',`pubname` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '出版社名称',PRIMARY KEY (`isbn`) )ENGINE = InnoDBDEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '出版信息表'ROW_FORMAT = Compact;CREATE TABLE `tb_purview` (`mid` int(10) UNSIGNED NOT NULL COMMENT '管理员id',`sysset` tinyint(1) NULL DEFAULT 0 COMMENT '系统权限',`readerset` tinyint(1) NULL DEFAULT 0 COMMENT '读者权限',`bookset` tinyint(1) NULL DEFAULT 0 COMMENT '图书权限',`borrowback` tinyint(1) NULL DEFAULT 0 COMMENT '借阅权限',`sysquery` tinyint(1) NULL DEFAULT 0 COMMENT '系统查询权限',PRIMARY KEY (`mid`) )ENGINE = InnoDBDEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '权限设置表'ROW_FORMAT = Compact;CREATE TABLE `tb_reader` (`rid` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '读者id',`rname` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '读者名称',`gender` varchar(4) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '性别',`vocation` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '行业',`birthday` date NULL DEFAULT NULL COMMENT '生日',`papertype` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '证件类型',`paperno` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '证件号码',`tel` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '电话',`email` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT 'Email',`createdate` date NULL DEFAULT NULL COMMENT '创建时间',`remark` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '备注',`rtypeid` tinyint(4) UNSIGNED NULL DEFAULT NULL COMMENT '读者类型id',`operator` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '操作员',PRIMARY KEY (`rid`) ,INDEX `fk_rtypeid` (`rtypeid` ASC) USING BTREE)ENGINE = InnoDBAUTO_INCREMENT = 3DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '读者表'ROW_FORMAT = Compact;CREATE TABLE `tb_readertype` (`rtypeid` tinyint(4) UNSIGNED NOT NULL COMMENT '读者类型id',`rtypename` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '读者类型名称',`count` int(4) NULL DEFAULT NULL COMMENT '可借图书数量',PRIMARY KEY (`rtypeid`) ,INDEX `uk_rtypename` (`rtypename` ASC) USING BTREE)ENGINE = InnoDBDEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '读者类型表'ROW_FORMAT = Compact;CREATE TABLE `tb_return` (`swid` int(10) UNSIGNED ZEROFILL NOT NULL AUTO_INCREMENT COMMENT '流水号',`rid` int(10) UNSIGNED NULL DEFAULT NULL COMMENT '读者id<FK>',`bookid` int(11) UNSIGNED NULL DEFAULT NULL COMMENT '图书id',`backtime` date NULL DEFAULT NULL COMMENT '实际归还时间',`operator` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '操作员',PRIMARY KEY (`swid`) ,INDEX `fk_return_rid` (`rid` ASC) USING BTREE,INDEX `fk_return_bookid` (`bookid` ASC) USING BTREE)ENGINE = InnoDBAUTO_INCREMENT = 6DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '图书归还表'ROW_FORMAT = Compact;CREATE TABLE `tb_shelf` (`shelfid` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '书架id',`shelfname` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '书架名',PRIMARY KEY (`shelfid`) )ENGINE = InnoDBAUTO_INCREMENT = 5DEFAULT CHARACTER SET = utf8COLLATE = utf8_general_ciCOMMENT = '书架表'ROW_FORMAT = Compact;-- ---------------------------------------------------------------- 添加外键约束-- --------------------------------------------------------------ALTER TABLE `tb_bookinfo` ADD CONSTRAINT `fk_isbn` FOREIGN KEY (`isbn`) REFERENCES `tb_publishing` (`isbn`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_bookinfo` ADD CONSTRAINT `fk_shelfid` FOREIGN KEY (`shelfid`) REFERENCES `tb_shelf` (`shelfid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_bookinfo` ADD CONSTRAINT `fk_typeid` FOREIGN KEY (`typeid`) REFERENCES `tb_booktype` (`typeid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_borrow` ADD CONSTRAINT `fk_borrow_bookid` FOREIGN KEY (`bookid`) REFERENCES `tb_bookinfo` (`bookid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_borrow` ADD CONSTRAINT `fk_borrow_rid` FOREIGN KEY (`rid`) REFERENCES `tb_reader` (`rid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_purview` ADD CONSTRAINT `fk_mid` FOREIGN KEY (`mid`) REFERENCES `tb_manager` (`mid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_reader` ADD CONSTRAINT `fk_rtypeid` FOREIGN KEY (`rtypeid`) REFERENCES `tb_readertype` (`rtypeid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_return` ADD CONSTRAINT `fk_return_bookid` FOREIGN KEY (`bookid`) REFERENCES `tb_bookinfo` (`bookid`) ON DELETE RESTRICT ON UPDATE RESTRICT;ALTER TABLE `tb_return` ADD CONSTRAINT `fk_return_rid` FOREIGN KEY (`rid`) REFERENCES `tb_reader` (`rid`) ON DELETE RESTRICT ON UPDATE RESTRICT;